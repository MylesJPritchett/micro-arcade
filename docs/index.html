<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>crisp-game-lib</title>
    <meta
      name="viewport"
      content="width=device-width, height=device-height,
    user-scalable=no, initial-scale=1, maximum-scale=1"
    />
    <!-- Load 'algo-chip' or 'sounds-some-sounds' if 'isSoundEnabled' option is true -->
    <script src="https://unpkg.com/algo-chip@1.0.2/packages/core/dist/algo-chip.umd.js"></script>
    <script src="https://unpkg.com/algo-chip@1.0.2/packages/util/dist/algo-chip-util.umd.js"></script>
    <!--
    <script src="https://unpkg.com/sounds-some-sounds@3.1.1/build/index.js"></script>
    -->
    <!-- Load 'pixi' when using pixi theme -->
    <script src="https://unpkg.com/pixi.js@5.3.0/dist/pixi.min.js"></script>
    <script src="https://unpkg.com/pixi-filters@3.1.1/dist/pixi-filters.js"></script>
    <!-- Load 'gif-capture-canvas' if 'isCapturing' option is true -->
    <script src="https://unpkg.com/gif-capture-canvas@1.1.0/build/index.js"></script>
    <!-- Load 'lodash.clonedeep' when using rewind -->
    <script>
      var module = {};
    </script>
    <script src="https://unpkg.com/lodash.clonedeep@4.5.0/index.js"></script>
    <!-- Load 'terser' if 'isMinifying' option is true -->
    <!--
    <script src="https://unpkg.com/terser@4.6.11/dist/bundle.min.js"></script>
    -->
    <script src="bundle.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const params = new URLSearchParams(window.location.search);
        const gameName = params.get("game");
        // This list is auto-generated by scripts/generate-game-list.js
        const games = ["bridge","dodge","flap","react"]

        if (gameName && games.includes(gameName)) {
          // A game is specified, load it
          document.title = gameName;
          const script = document.createElement("script");
          script.src = `${gameName}/main.js`;
          document.head.appendChild(script);
          window.addEventListener("load", onLoad);
        } else {
          // No game specified, show the dashboard
          document.title = "Game Collection";
          const gameCards = games
            .map((game) => {
              const title = game.charAt(0).toUpperCase() + game.slice(1);
              const keyPrefix = `crisp-game-${title}-`;
              let highScore = 0;
              for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith(keyPrefix)) {
                  try {
                    const value = JSON.parse(localStorage.getItem(key));
                    if (value && value.highScore) {
                      highScore = value.highScore;
                      break;
                    }
                  } catch (e) {
                    // Ignore if parsing fails
                  }
                }
              }
              return `
          <a href="?game=${game}" class="game-card">
              <div class="placeholder"><img src="${game}/${game}.gif" alt="${title}" width="100" height="100"></div>
              <h2>${game}</h2>
              <p class="high-score">High Score: ${highScore}</p>
          </a>
        `;
            })
            .join("");

          document.body.innerHTML = `
<style>
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f0f0 !important;
    }
    h1 {
        text-align: center;
    }
    .grid-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }
    .game-card {
        width: 100px;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        overflow: hidden;
        text-decoration: none;
        color: #333;
        display: block;
        transition: transform 0.2s;
    }
    .game-card:hover {
        transform: translateY(-5px);
    }
    .game-card .placeholder {
        width: 100px;
        height: 100px;
        background-color: #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2em;
        color: #aaa;
        text-transform: capitalize;
    }
    .game-card h2 {
        font-size: 1.2em;
        margin: 0;
        padding: 15px 5px 5px;
        text-align: center;
        text-transform: capitalize;
    }
    .high-score {
        margin: 0;
        padding: 0 5px 15px;
        text-align: center;
        color: #555;
    }
    .footer {
      padding: 20px;
      text-align: center;
    }
</style>
<h1>Game Collection</h1>
<div class="grid-container">
    ${gameCards}
</div>
<div class="footer">
  Read more about <a href="https://mylesp.com/portfolio/micro-arcade">this project</a>(and <a href="https://mylesp.com">me!</a>)
</div>
`;
        }
      });
    </script>
  </head>
  <body style="background: #ddd"></body>
</html>
